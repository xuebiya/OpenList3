# OpenList 日志系统更新说明

## 更新内容

已成功将日志系统移植到最新版 OpenList，并新增了智能访问行为检测功能。

## 主要特性

### 1. 访问行为智能识别
日志现在可以自动识别并记录以下访问行为：
- **直接播放**：浏览器在线播放
- **播放器播放**：VLC、PotPlayer 等专业播放器
- **下载**：下载到本地
- **浏览器查看**：查看图片等

### 2. 共享功能完全支持
- 自动识别共享访问
- 记录共享ID和创建者信息
- 区分普通访问和共享访问

### 3. 日志格式示例

#### 普通用户播放视频
```
时间：2025年10月8日 14:30:25 访问IP：192.168.1.100 用户：admin 行为：直接播放 访问路径：/d/movies/video.mp4
```

#### 使用 VLC 播放器访问
```
时间：2025年10月8日 14:30:25 访问IP：192.168.1.100 用户：admin 行为：播放器播放 访问路径：/d/movies/video.mp4
```

#### 访客通过共享链接访问
```
时间：2025年10月8日 14:30:25 访问IP：192.168.1.100 用户：访客 行为：直接播放 共享ID：abc123def456 共享创建者：admin 访问路径：/sd/abc123def456/movies/video.mp4
```

## 行为检测原理

系统通过以下多种方式智能判断访问行为：

1. **User-Agent 检测**：识别 20+ 种常见播放器
2. **Range 请求头**：分析流式播放特征
3. **请求路径分析**：区分下载、播放、代理等不同路径
4. **浏览器识别**：区分浏览器和下载工具

## 支持的播放器

### 桌面播放器
VLC, PotPlayer, MPlayer, mpv, KMPlayer, IINA

### 媒体中心
Kodi, Plex, Emby, Jellyfin

### 系统播放器
QuickTime, Windows Media Player, RealPlayer

### 其他
FFmpeg, GStreamer, ExoPlayer (Android), AppleCoreMedia (iOS)

## 文件列表

### 新增/修改的文件
1. `OpenList-main/server/middlewares/media_logger.go` - 媒体日志中间件（新增）
2. `OpenList-main/cmd/server.go` - 服务器配置（已修改）
3. `OpenList-main/README_media_logger.md` - 详细文档（新增）
4. `OpenList-main/日志系统更新说明.md` - 本文件（新增）

## 兼容性说明

✅ **完全兼容新版所有功能**
- 共享功能正常工作
- 用户认证不受影响
- API 调用正常
- WebDAV、S3、FTP、SFTP 等服务不受影响

✅ **无需额外配置**
- 系统启动后自动生效
- 调试模式自动切换

## 使用建议

1. **生产环境**：使用正常模式，只记录媒体文件访问
2. **开发环境**：使用调试模式（--dev 或 --debug 标志）
3. **日志清理**：定期清理日志文件，避免占用过多空间
4. **自定义扩展**：根据需要在 `media_logger.go` 中添加更多播放器或文件格式

## 详细文档

更多详细信息请参阅：`README_media_logger.md`

